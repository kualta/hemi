name: GitHub Pages

on:
  push:
    branches:
      - master

jobs:
  build-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable

      - name: Install Dioxus CLI
        run: |
          curl -L --proto '=https' --tlsv1.2 -sSf https://raw.githubusercontent.com/cargo-bins/cargo-binstall/main/install-from-binstall-release.sh | bash
          cargo binstall dioxus-cli@0.6.3 --no-confirm

      - name: Build project
        run: dx build --release --platform web

      - name: Debug - List build output
        run: |
          echo "=== Build output structure ==="
          ls -la ./target/dx/hemi/release/web/public/
          echo "=== Assets folder ==="
          ls -la ./target/dx/hemi/release/web/public/assets/ || echo "No assets folder"

      - name: Copy CNAME file to root
        run: cp ./assets/CNAME ./target/dx/hemi/release/web/public/CNAME

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./target/dx/hemi/release/web/public
